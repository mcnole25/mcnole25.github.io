<!DOCTYPE html>
<html>
    <head>
        <title>Platformer Minigame</title>
        <style>
            h1 {color: #ffff00; font-family: trebuchet ms; text-align: center; font-size:300%}
            p {color: #ffffff; font-family: trebuchet ms; text-align: center; font-size:150%}
            body {background-color: #404040;}
            #myCanvas {display: block; margin: 0 auto;}
            .small-text {font-size: 100%}
        </style>
    </head>
    <body>
        <h1>Platformer Minigame</h1>
        <p>Simulate a platformer quickly using simple Javascript</p>
        <canvas id=myCanvas width=512 height=512 style="background-color: #ffffff">
        </canvas>
        <script>
              var ctx = myCanvas.getContext("2d");
              lvlHeight = 20064;
              lvlX = Array.from({length: lvlHeight / 16}, () => Math.floor(Math.random() * 16) * 32);
              lvlY = Array.from({length: lvlHeight / 16}, () => Math.floor(Math.random() * (lvlHeight / 32 - 3)) * 32 - (lvlHeight - 576));
              ctx.fillStyle = "#80ffff";
              x = 244;
              y = 488;
              xv = 0;
              yv = 0;
              falling = 0;
              scroll = 0;
              towerHeight = 0;
              setInterval(function() {
                  ctx.clearRect(0, 0, 512, 512);
                  // New feature: "Dynamic Colours"
                  percent = (Math.floor(488 - y) / towerHeight)
                  firstPercent = percent * 2
                  secondPercent = (percent - 0.5) * 4
                  thirdPercent = (percent - 0.75) * 4
                  if (percent < 0.5) {
                      ctx.fillStyle = "rgb(" + (127.5 + firstPercent * 127.5) + ", 255, " + (255 - firstPercent * 191.25) + ")"
                  } else if (percent < 0.75) {
                      ctx.fillStyle = "rgb(" + (255 - secondPercent * 63.75) + ", " + (255 - secondPercent * 255) + ", " + (63.75 - secondPercent * 63.75) + ")"
                  } else {
                      ctx.fillStyle = "rgb(" + (191.25 - thirdPercent * 191.25) + ", 0, " + (thirdPercent * 127.5) + ")"
                  }
                  ctx.fillRect(0, 0, 512, 512)
                  ctx.fillStyle = "#000000";
                  for (i = 0; i < lvlX.length; i = i + 1) {
                      ctx.fillRect(lvlX[i], lvlY[i] + scroll, 32, 32);
                  }
                  ctx.fillStyle = "#808080";
                  ctx.fillRect(x, y + scroll, 24, 24);
                  yv = yv + 1;
                  falling = falling + 1;
                  function MoveSteps(steps) {
                      for (i = 0; i < steps; i = i + 1) {
                          lastValue = x;
                          x = x + xv / steps;
                          for (j = 0; j < lvlX.length; j = j + 1) {
                              if (x > lvlX[j] - 24 && x < lvlX[j] + 32 && y > lvlY[j] - 24 && y < lvlY[j] + 32) {
                                  x = lastValue;
                                  xv = 0;
                              }
                          }
                          lastValue = y;
                          y = y + yv / steps;
                          for (j = 0; j < lvlY.length; j = j + 1) {
                              if (x > lvlX[j] - 24 && x < lvlX[j] + 32 && y > lvlY[j] - 24 && y < lvlY[j] + 32) {
                                  y = lastValue;
                                  yv = 0;
                                  falling = 0;
                              }
                          }
                      }
                  }
                  MoveSteps(Math.abs(xv) + Math.abs(yv))
                  if (x < 0) {while (x < 0) {x = x + 1;}}
                  if (x > 488) {while (x > 488) {x = x - 1;}}
                  if (y < 536 - lvlHeight) {while (y < 536 - lvlHeight) {y = y + 1; yv = 0;}}
                  if (y > 488) {while (y > 488) {y = y - 1; falling = 0;}}
let keys = {
      left: false,
      up: false,
      right: false
    };
    addEventListener("keydown", (event) => {
      if (event.key === "ArrowLeft") {
        keys.left = true;
      }
      if (event.key === "ArrowUp") {
        keys.up = true;
      }
      if (event.key === "ArrowRight") {
        keys.right = true;
      }
    if (keys.left) {xv = -8}
    if (keys.up && falling <= 1) {yv = -20}
    if (keys.right) {xv = 8}
    });
    addEventListener("keyup", (event) => {
      if (event.key === "ArrowLeft") {
        keys.left = false;
      }
      if (event.key === "ArrowUp") {
        keys.up = false;
      }
      if (event.key === "ArrowRight") {
        keys.right = false;
      }
      if (!(keys.left) && !(keys.right)) {xv = 0}
    });
                  scroll = scroll - (y + scroll - 244) / 40;
                  towerHeight = lvlHeight - 64;
                  if (scroll < 0) {scroll = 0}
                  if (scroll > lvlHeight - 536) {scroll = lvlHeight - 536}
                  document.getElementById("height").innerHTML = "Height: " + Math.floor(488 - y) / 100 + " / " + towerHeight / 100 + "m";
              }, 25);
        </script>
        <p id="height"></p>
        <p class="small-text">Use the left/right keys to move and the up key to jump.</p>
        <p class="small-text">Made by JC</p>
    </body>
</html>
